<!DOCTYPE html>
<title>Page Title</title>
<link href="/css/workflow.css" rel="stylesheet"  type="text/css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.2.1/mustache.js"></script>
<body id="body" ng-controller="workflowController">
<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
        </div>

        <!--<a class="navbar-brand navbar-center" ng-href="/boards">Boards</a>-->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Menu<span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a ng-href="/boards">Boards</a></li>
                    <li><a href="#">Calendar</a></li>
                    <li><a href="#">Settings</a></li>
                    <li role="separator" class="divider"></li>
                    <li><a href="#">Separated link</a></li>
                    <li role="separator" class="divider"></li>
                    <li><a href="#">One more separated link</a></li>
                </ul>
            </li>
        </ul>
        <form class="navbar-form navbar-left" role="search">
            <input type="text" class="form-control" placeholder="Search">
        </form>
        </div>

    </div>
</nav>


<div class="container">       
   <div id="workflow-container" class="row">

    <div class="modal fade" id="workflow-form" tabindex="-1" role="dialog"
    aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content" style="height:220px;">
                <!-- Modal Header -->
                <button id="dismiss-popup-button" type="button" class="btn btn-danger btn-md" data-dismiss="modal" style="margin:20px;"><i class="glyphicon glyphicon-remove" ng-click="dismissWorkflowForm()"></i></button>
                <!-- Modal Body -->
                <div class="modal-body" style="margin-top: 30px;"> 
                    <form ng-submit="addNewWorkflow()" style="text-align:center;">
                        <div class="input-group" style="margin:20px;">
                            <span class="input-group-addon success"><span class="glyphicon glyphicon-plus"></span></span>
                            <input id="create-new-workflow-input" type="text" class="form-control input-lg" name="validate-optional" placeholder="New Workflow!" ng-model="newWorkflowTitle" ng-keyup="checkDataInCreateNewWorkflowInput()">
                        </div>
                        <div style="margin:20px;">
                        <button id="create-new-workflow-button" type="submit" class="btn btn-primary col-xs-12 btn-lg" ng-disabled="!newWorkflowTitle">Create</button>
                        </div>
                    </form>                               
                </div>
            </div>
        </div>
    </div>

    <!-- Add Workflow Button -->
    <button id="add-workflow-button" type="button" class="btn btn-circle btn-lg" data-toggle="modal" data-target="#workflow-form"><i class="glyphicon glyphicon-plus"></i></button>


    <!-- Create and Edit Task Popup -->
    <div class="modal fade" id="task-form" tabindex="-1" role="dialog"
    aria-labelledby="myModalLabel" aria-hidden="true" ng-model="boardPopupState">
        <div class="modal-dialog">
            <div class="modal-content" style="height:500px;">
                <!-- Modal Header -->
                <div class="modal-header">
                    <button id="dismiss-create-task-popup-button" type="button" class="btn btn-danger btn-md" data-dismiss="modal" ng-click="dismissTaskForm()"><i class="glyphicon glyphicon-remove"></i></button>      
                    <ul class="nav nav-pills">
                        <li id="task-details-tab"role="presentation" class="active"><a href="#" ng-click="showTaskDetailsView()"><i class="glyphicon glyphicon-cog"></i> Details</a></li>
                        <li id="task-comments-tab" role="presentation"><a href="#" ng-click="showTaskCommentsView()"><i class="glyphicon glyphicon-comment"></i> {{comments.length}} Comments</a></li>
                        <li id="task-activity-tab" role="presentation"><a href="#"><i class="glyphicon glyphicon-book"></i> Activity</a></li>
                    </ul>
                </div>
                <!-- Modal Body -->
                <div class="modal-body">
                    <div class="task-details-view">
                    <form ng-submit="submitTaskForm()" style="text-align:center; position:relative;">
                        <div class="input-group" style="margin:20px;">
                            <span class="input-group-addon success"><span class="glyphicon glyphicon-plus"></span></span>
                            <input id="task-name-input" type="text" class="form-control input-lg" name="validate-optional" placeholder="New Task" ng-model="taskFormName" required>
                        </div>
                        <div class="input-group" style="margin:20px;">
                                <span class="input-group-addon success"><span class="glyphicon glyphicon-pencil"></span></span>
                                <textarea class="form-control" name="description" placeholder="Description" rows="3" ng-model="taskFormDescription"></textarea>    
                        </div>
                        <div class="input-group" style="margin:20px;">
                                <div style="float:left">
                                <div class="input-group">
                                <span class="input-group-addon success"><span class="glyphicon glyphicon-calendar"></span></span>
                                <input id="create-new-workflow-input" type="date" class="form-control input-lg" ng-model="taskFormDate">
                                <!--Due Date: <input type="date" name="bday">-->
                                </div>
                                </div>
                                <div style="float:right; margin-left:15px;">
                                Priority: <div class="btn-group btn-group-md" role="group" aria-label="...">
                                  <button type="button" class="btn btn-success">Low</button>
                                  <button type="button" class="btn btn-warning">Medium</button>
                                  <button type="button" class="btn btn-danger">High</button>
                                </div>
                                </div>
                        </div>
                        <div class="assigneeInput">
                            <div class="input-group" style="margin-top:20px; margin-left:20px; margin-right:20px;" >
                                <span class="input-group-addon success"><span class="glyphicon glyphicon-user"></span></span>
                                <input id="tags" type="text" class="form-control input-lg" name="validate-optional" placeholder="Assignee" ng-model="taskFormAssignee" ng-keyup="assigneeInputKeyEvent($event)" autocomplete="off">
                            </div>
                             <ul ng-repeat="assignee in assignees" style="padding:0; posiition: absolute; z-index: 3; list-style-type: none; margin-left:20px; margin-right:20px;">
                                <li><button type="button" ng-click="assignUserToTask(assignee)" style="width:100%; height:40px;">{{assignee.username}}</button></li>
                            </ul>
                        </div>
                        <div 
                        <div ng-if="assignedUser" class="input-group" style="margin-top:20px; margin-left:20px; margin-right:20px;">
                            <div class="assigneeTo">
                                <span><span class="glyphicon glyphicon-user"></span> Assigned to : {{assignedUser.username}}<button type="button" class="btn btn-danger btn-md" style="margin:5px;" ng-click="removeAssignee(assignedUser)"><i class="glyphicon glyphicon-remove"></i></button></span>
                            </div>
                        </div>                    

                        <!--
                        <div class="input-group" style="margin-top:20px; margin-left:20px; margin-right:20px;" >
                            <span class="input-group-addon success"><span class="glyphicon glyphicon-user"></span></span>
                            <div> tom </div>
                        </div>
                        -->
                        <div style="margin:20px;">
                        <button id="create-task-button" type="submit" class="btn btn-primary col-xs-12 btn-lg" style="text-transform: uppercase;" ng-disabled="!taskFormName">{{taskFormState}}</button>
                        </div>
                    </form> 
                    </div> 
                    <div class="task-comments-view">
                        <div style="width:100%; height: 350px; overflow: auto">
                        <ul class="media-list" ng-repeat="comment in comments" >
                            <li class="media">
                                <div class="media-left">
                                    <img src="http://placehold.it/60x60" class="img-circle">
                                </div>
                                <div class="media-body">
                                    <h4 class="media-heading">
                                        {{comment.creator.username}}
                                        <br>
                                        <small>
                                            commented on {{comment.date}}
                                        </small>
                                    </h4>
                                    <p>
                                        {{comment.comment}}
                                    </p>
                                </div>
                            </li>
                            <!--
                            <li class="media">
                                <div class="media-left">
                                    <img src="http://placehold.it/60x60" class="img-circle">
                                </div>
                                <div class="media-body">
                                    <h4 class="media-heading">
                                        Mauris Eu
                                        <br>
                                        <small>
                                            commented on <a href="#">Post Title</a>
                                        </small>
                                    </h4>
                                    <p>
                                        Vivamus pulvinar mauris eu placerat blandit. In euismod tellus vel ex vestibulum congue...
                                    </p>
                                </div>
                            </li>
                            -->
                        </ul>
                        </div>
                        <div class="comment-input">
                            <form ng-submit="addComment(newComment)">
                                <div class="input-group">
                                        <input class="form-control send-message" ng-model="newComment" placeholder="Leave a comment!"></input>
                                        <span class="input-group-addon btn btn-success" ng-click="addComment(newComment)">Send</span>
                                </div> 
                            </form> 
                        </div>
                    </div>
                </div>
        </div>
    </div>
    </div>
    <!---->    
</div>

<ul ng-repeat="workflow in workflows" class="workflow-list">
    <li>
        <div id="{{workflow._id}" class='col-lg-4 col-lg-4' ng-model="workflowId">
            <div class='panel panel-default'>
                <div class='panel-heading'>
                    <h4 class='panel-title'><a data-toggle='collapse' data-parent='#accordion' href='#collapseOne'>{{workflow.title}}</a></h4>
                    </div>
                        <div id='collapseOne' class='panel-collapse collapse in'>
                        <div class='panel-body'>
                        <div style="max-height: 350px; overflow-y:scroll;">
                        <ul class='list-group' ng-repeat="task in workflow.tasks">
                            <li id="{{task._id}}" class="list-group-item task-box">
                                <a href="#" style="text-decoration: none !important;" class="task-link">
                                <p style="word-break:break-all; margin-right: 10px; font-size: medium;">{{task.title}}</p>
                                <p ng-if="task.description" class="task-detail">Details : {{task.description}}</p>
                                <div>{{task.creator.username}}</div>
                                <button type="button" class="btn btn-danger btn-md task-remove-button" ng-click="deleteTask(task._id, workflow)"><i class="glyphicon glyphicon-remove"></i></button>
                                <button type="button" class="btn btn-primary btn-md task-edit-button" ng-click="editTask(task, workflow)" data-toggle="modal" data-target="#task-form"><i class="glyphicon glyphicon-cog"></i></button>
                                <button type="button" class="btn btn-info btn-md task-edit-button">50%</button>
                                <button type="button" class="btn btn-success btn-md task-edit-button"><i class="glyphicon glyphicon-calendar"></i>  3wk</button>
                                <span class="show-menu">
                                <span class="glyphicon glyphicon-chevron-right" rel="tooltip" title="Tip 1"></span>
                                </span>
                                </a>
                            </li> 
                        </ul>
                        </div>
                        <div style="margin-top: 15px;">
                            <button id="add-task-button" class="btn btn-circle pull-right" ng-click="addTask(workflow)" data-toggle="modal" data-target="#task-form">
                                <i class="glyphicon glyphicon-plus"></i>
                            </button>
                        </div>
                        </div>
                </div>
            </div>
        </div>        
    </li>   
</ul>
</body>